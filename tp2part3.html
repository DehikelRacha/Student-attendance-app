<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Attendance Tracker</title>

<style>
/* ===== GENERAL + NAVBAR ===== */
body {
  font-family: "Poppins", sans-serif;
  background: #E8DBC4;
  margin: 0;
}

nav {
  background: linear-gradient(90deg, #561C24, #6D2932);
  color: #E8DBC4;
  padding: 14px 30px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
nav .title { font-size: 1.4em; font-weight: 600; }

nav ul {
  list-style: none;
  display: flex;
  gap: 25px;
  margin: 0;
  padding: 0;
}

nav a {
  color: #E8DBC4;
  text-decoration: none;
  font-weight: 500;
}
nav a:hover { color: #C7B7A3; }

/* ===== CONTAINER ===== */
.container {
  max-width: 1100px;
  margin: 40px auto;
  background: white;
  padding: 30px;
  border-radius: 16px;
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

h1 { text-align: center; color:#561C24; }
h2 { border-left:5px solid #561C24; padding-left:10px; color:#6D2932; }

/* ===== TABLE ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 20px;
  border-radius: 10px;
  overflow: hidden;
}
th {
  background:#C7B7A3;
  color:#561C24;
  padding:8px;
  border:1px solid #6D2932;
}
td {
  padding:8px;
  border:1px solid #C7B7A3;
  text-align:center;
}
tbody tr td { background:white !important; }

/* checkboxes */
input[type="checkbox"] {
  width: 18px;
  height: 18px;
  accent-color:#6D2932;
}

/* highlight */
.good td { background:#A5E6A1 !important; }
.warning td { background:#FFF8A6 !important; }
.danger td { background:#F28B82 !important; color:white !important; }

/* delete button */
.delete-btn {
  background:#6D2932;
  color:#E8DBC4;
  border:none;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
  font-weight:600;
}
.delete-btn:hover { background:#561C24; }

form {
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  margin-top:25px;
}
label { font-weight:600; color:#561C24; }
input[type="text"], input[type="email"] {
  width:100%;
  padding:9px;
  border:1px solid #C7B7A3;
  border-radius:6px;
}
button {
  grid-column:span 2;
  background:linear-gradient(90deg,#6D2932,#561C24);
  color:#E8DBC4;
  padding:12px;
  border-radius:8px;
  border:none;
  cursor:pointer;
  font-weight:600;
}
button:hover{transform:scale(1.05);}
.error{color:#6D2932;font-weight:bold;font-size:14px;}

.report-box{
  margin-top:20px;
  padding:16px;
  border-radius:8px;
  background:#C7B7A3;
  color:#561C24;
}
.report-row{display:flex;gap:14px;align-items:center;margin:6px 0;}
.report-value{font-weight:700;color:#6D2932;margin-left:8px;}
</style>
</head>

<body>

<nav>
  <div class="title">Attendance System</div>
  <ul>
    <li><a href="#home">Home</a></li>
    <li><a href="#attendance">Attendance</a></li>
    <li><a href="#add">Add Student</a></li>
    <li><a href="#report" id="reportLink">Report</a></li>
    <li><a href="#" id="logoutBtn">Logout</a></li>
  </ul>
</nav>

<div class="container" id="home">
<h1>Student Attendance Tracker</h1>

<h2 id="attendance">Attendance Table</h2>

<table id="attendanceTable">
  <thead>
    <tr>
      <th>Last</th><th>First</th>

      <th colspan="2">S1</th>
      <th colspan="2">S2</th>
      <th colspan="2">S3</th>
      <th colspan="2">S4</th>
      <th colspan="2">S5</th>
      <th colspan="2">S6</th>

      <th>Abs</th><th>Part</th><th>Message</th><th>Action</th>
    </tr>

    <tr>
      <th></th><th></th>
      <th>P</th><th>Part</th>
      <th>P</th><th>Part</th>
      <th>P</th><th>Part</th>
      <th>P</th><th>Part</th>
      <th>P</th><th>Part</th>
      <th>P</th><th>Part</th>
      <th></th><th></th><th></th><th></th>
    </tr>
  </thead>

  <tbody>

    <!-- Row 1 -->
    <tr data-touched="true">
      <td>Dehikel</td><td>Racha</td>

      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>

      <td class="abs"></td>
      <td class="part"></td>
      <td class="msg"></td>
      <td><button class="delete-btn">Delete</button></td>
    </tr>

    <!-- Row 2 -->
    <tr data-touched="true">
      <td>Djelouah</td><td>Zineb</td>

      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>

      <td class="abs"></td>
      <td class="part"></td>
      <td class="msg"></td>
      <td><button class="delete-btn">Delete</button></td>
    </tr>

    <!-- Row 3 -->
    <tr data-touched="true">
      <td>Yacine</td><td>Ali</td>

      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox"></td><td><input type="checkbox" checked></td>
      <td><input type="checkbox" checked></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>
      <td><input type="checkbox"></td><td><input type="checkbox"></td>

      <td class="abs"></td>
      <td class="part"></td>
      <td class="msg"></td>
      <td><button class="delete-btn">Delete</button></td>
    </tr>

  </tbody>
</table>

<form id="studentForm">
  <div>
    <label>Student ID</label>
    <input type="text" id="id">
    <div class="error" id="idError"></div>
  </div>

  <div>
    <label>Last Name</label>
    <input type="text" id="lastName">
    <div class="error" id="lastError"></div>
  </div>

  <div>
    <label>First Name</label>
    <input type="text" id="firstName">
    <div class="error" id="firstError"></div>
  </div>

  <div>
    <label>Email</label>
    <input type="email" id="email">
    <div class="error" id="emailError"></div>
  </div>

  <button type="submit">Validate</button>
</form>

<!-- ==============================
       â­ WEEKLY BAR CHART â­
================================ -->
<h2 style="margin-top:40px;">Weekly Attendance Chart</h2>
<canvas id="weekChart" style="max-width:500px;margin:auto;display:block;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="report-box" id="report">
  <h3>ðŸ“Š Attendance Report</h3>
  <div class="report-row">Total students: <div class="report-value" id="rTotal">0</div></div>
  <div class="report-row">Present at least once: <div class="report-value" id="rPresent">0</div></div>
  <div class="report-row">Participated at least once: <div class="report-value" id="rParticipated">0</div></div>
  <div class="report-row">Excluded (5+ abs): <div class="report-value" id="rExcluded">0</div></div>
  <div class="report-row">Attendance rate: <div class="report-value" id="rAttendanceRate">0%</div></div>
  <div class="report-row">Participation rate: <div class="report-value" id="rParticipationRate">0%</div></div>
</div>

</div>

<script>
/* =============================
       UPDATE ATTENDANCE COLORS
============================= */
function updateAttendance() {
  const rows = document.querySelectorAll("#attendanceTable tbody tr");

  rows.forEach(row => {
    const checks = row.querySelectorAll("input");
    let abs = 0;
    let part = 0;

    // absences
    for (let i = 0; i < 12; i += 2) {
      if (!checks[i].checked) abs++;
    }

    // participation
    for (let i = 1; i < 12; i += 2) {
      if (checks[i].checked) part++;
    }

    row.querySelector(".abs").textContent = abs;
    row.querySelector(".part").textContent = part;

    row.classList.remove("good","warning","danger");

    if (abs < 3) row.classList.add("good");
    else if (abs <= 4) row.classList.add("warning");
    else row.classList.add("danger");

    const msg = row.querySelector(".msg");

    if (abs < 3) {
      msg.textContent = part >= 3 
        ? "Good attendance â€“ Excellent participation" 
        : "Good attendance â€“ Needs more participation";
    }
    else if (abs <= 4) msg.textContent = "Warning â€“ Attendance low";
    else msg.textContent = "Excluded â€“ Too many absences";
  });
}

/* CHECKBOX UPDATE LISTENER */
document.querySelector("#attendanceTable tbody").addEventListener("change", e => {
  if (e.target.matches("input[type='checkbox']")) {
    updateAttendance();
    updateReport();
    updateWeekChart();
  }
});

/* =============================
         DELETE BUTTON
============================= */
document.querySelector("#attendanceTable tbody").addEventListener("click", e => {
  if (e.target.classList.contains("delete-btn")) {
    e.target.closest("tr").remove();
    updateReport();
    updateWeekChart();
  }
});

/* =============================
         REPORT SYSTEM
============================= */
function updateReport() {
  const rows = [...document.querySelectorAll("#attendanceTable tbody tr")];

  const total = rows.length;
  let presentStudents = 0;
  let participatedStudents = 0;
  let excluded = 0;

  rows.forEach(row => {
    const checks = row.querySelectorAll("input");

    let abs = 0;
    let present = false;
    let part = false;

    for (let i = 0; i < 12; i += 2) {
      if (!checks[i].checked) abs++;
      else present = true;
    }

    for (let i = 1; i < 12; i += 2) {
      if (checks[i].checked) part = true;
    }

    if (present) presentStudents++;
    if (part) participatedStudents++;
    if (abs >= 5) excluded++;
  });

  document.getElementById("rTotal").textContent = total;
  document.getElementById("rPresent").textContent = presentStudents;
  document.getElementById("rParticipated").textContent = participatedStudents;
  document.getElementById("rExcluded").textContent = excluded;

  document.getElementById("rAttendanceRate").textContent =
    total ? ((presentStudents / total)*100).toFixed(1)+"%" : "0%";

  document.getElementById("rParticipationRate").textContent =
    total ? ((participatedStudents / total)*100).toFixed(1)+"%" : "0%";
}

/* INITIAL UPDATES */
updateAttendance();
updateReport();

/* ==========================================
          ADD NEW STUDENT FIX ðŸ”¥
=========================================== */
document.getElementById("studentForm").addEventListener("submit", function(e) {
  e.preventDefault();

  let id = document.getElementById("id").value.trim();
  let last = document.getElementById("lastName").value.trim();
  let first = document.getElementById("firstName").value.trim();
  let email = document.getElementById("email").value.trim();

  if (!id || !last || !first || !email) {
    alert("Please fill all fields.");
    return;
  }

  let tbody = document.querySelector("#attendanceTable tbody");
  let tr = document.createElement("tr");
  tr.setAttribute("data-touched", "true");

  tr.innerHTML = `
    <td>${last}</td>
    <td>${first}</td>

    <td><input type="checkbox"></td><td><input type="checkbox"></td>
    <td><input type="checkbox"></td><td><input type="checkbox"></td>
    <td><input type="checkbox"></td><td><input type="checkbox"></td>
    <td><input type="checkbox"></td><td><input type="checkbox"></td>
    <td><input type="checkbox"></td><td><input type="checkbox"></td>
    <td><input type="checkbox"></td><td><input type="checkbox"></td>

    <td class="abs"></td>
    <td class="part"></td>
    <td class="msg"></td>
    <td><button class="delete-btn">Delete</button></td>
  `;

  tbody.appendChild(tr);

  updateAttendance();
  updateReport();
  updateWeekChart();

  document.getElementById("studentForm").reset();
});

/* ============================================
        â­ WEEKLY BAR CHART (S1 â†’ S6) â­
============================================ */

let weekChart = null;

function updateWeekChart() {
  const rows = document.querySelectorAll("#attendanceTable tbody tr");

  let present = [0, 0, 0, 0, 0, 0];
  let absent = [0, 0, 0, 0, 0, 0];
  let participation = [0, 0, 0, 0, 0, 0];

  rows.forEach(row => {
    const checks = row.querySelectorAll("input");

    for (let s = 0; s < 6; s++) {
      const presentBox = checks[s*2];
      const partBox = checks[s*2 + 1];

      if (presentBox.checked) present[s]++;
      else absent[s]++;

      if (partBox.checked) participation[s]++;
    }
  });

  const ctx = document.getElementById("weekChart");

  if (weekChart) weekChart.destroy();

  weekChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ["S1", "S2", "S3", "S4", "S5", "S6"],
      datasets: [
        {
          label: "Present",
          data: present,
          backgroundColor: "#4CAF50"
        },
        {
          label: "Absent",
          data: absent,
          backgroundColor: "#E57373"
        },
        {
          label: "Participation",
          data: participation,
          backgroundColor: "#64B5F6"
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
}

updateWeekChart();

/* =============================
     REPORT + LOGOUT
============================= */

document.getElementById("reportLink").addEventListener("click", (e) => {
  e.preventDefault();
  updateReport();
  updateWeekChart();
  document.getElementById("report").scrollIntoView({ behavior: "smooth" });
});

document.getElementById("logoutBtn").addEventListener("click", e => {
  e.preventDefault();
  if (confirm("Are you sure you want to log out?")) {
    document.body.innerHTML = `
      <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;background:#E8DBC4;">
        <h1 style="color:#561C24;">You have been logged out.</h1>
        <p style="color:#6D2932;">Thank you for using the Attendance System.</p>
      </div>`;
  }
});
</script>

</body>
</html>
